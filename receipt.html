<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>ê²°ì œ ì™„ë£Œ | The Plastic Dining</title>

  <style>
    html, body { height: 100% }
    body {
      margin: 0;
      overflow: hidden;
      display: grid;
      place-items: center;
      background: #000; /* ë¡œë”©/í´ë°± */
    }

    /* ë°°ê²½ ì´ë¯¸ì§€ */
    .bg {
      position: fixed;
      inset: 0;
      background: #000 center/cover no-repeat;
      filter: blur(1px) brightness(.85);
      transform: scale(1.02);
      z-index: 0;
    }

    /* í™ˆ ë²„íŠ¼(ìš°ìƒë‹¨) */
    .home-btn{
      position: fixed;
      top: 18px;
      right: 22px;
      z-index: 2;
      display: inline-flex;
      padding: 6px;
      border-radius: 10px;
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(2px);
    }
    .home-btn img{
      width: 34px; height: 34px; display: block;
      filter: invert(1) brightness(.9);
    }

    /* ì¤‘ì•™ ì˜ì—­: ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ */
    .stage{
      position: relative;
      z-index: 1;
      display: grid;
      place-items: center;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
    }

    .receipt{
      max-width: 340px;
      width: 54vw;
      height: auto;
      display: block;
      box-shadow: 0 10px 40px rgba(0,0,0,.55);
      border-radius: 2px;
      user-select: none;
      -webkit-user-drag: none;
    }

    @media (max-width:480px){
      .receipt{ width: 82vw; max-width: 430px; }
    }

    /* í”„ë¦°íŠ¸ ë²„íŠ¼ */
    #printBtn {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      padding: 14px 22px;
      border-radius: 12px;
      background: rgba(255,255,255,0.85);
      font-size: 17px;
      font-weight: 600;
      z-index: 5;
      border: none;
    }
  </style>
</head>

<body>
  <!-- íë¦¿í•œ ë°°ê²½ -->
  <div class="bg" id="bg"></div>

  <!-- í™ˆìœ¼ë¡œ -->
  <a href="index.html" class="home-btn" aria-label="í™ˆìœ¼ë¡œ ì´ë™" title="Home">
    <img src="img/icon/home.png" alt="">
  </a>

  <!-- í”„ë¦°íŠ¸ ë²„íŠ¼ -->
  <button id="printBtn">ì˜ìˆ˜ì¦ í”„ë¦°íŠ¸í•˜ê¸°</button>

  <!-- ì¤‘ì•™ ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ -->
  <div class="stage">
    <img id="receiptImg" class="receipt" src="">
  </div>

  <!-- 30ë¶„ ë¬´ë™ì‘ ì‹œ í™ˆìœ¼ë¡œ ìë™ ì´ë™ -->
  <script>
    (function(){
      const HOME_URL    = 'index.html';
      const INACTIVE_MS = 30 * 60 * 1000; // 30ë¶„

      let timerId;

      function resetInactivityTimer() {
        if (timerId) clearTimeout(timerId);
        timerId = setTimeout(() => {
          window.location.href = HOME_URL;
        }, INACTIVE_MS);
      }

      const events = ['mousemove','mousedown','keydown','scroll','touchstart','click'];
      events.forEach(ev => window.addEventListener(ev, resetInactivityTimer));
      window.addEventListener('load', resetInactivityTimer);
    })();
  </script>

  <!-- ì¿¼ë¦¬ìŠ¤íŠ¸ë§(item)ì— ë”°ë¼ ì˜ìˆ˜ì¦ ì´ë¯¸ì§€/ë°°ê²½ ë¡œë“œ -->
  <script>
    (function () {
      const params = new URLSearchParams(location.search);
      const item = params.get('item') || 'salad_gardenbag';

      const BG_PATH = 'img/receipt/receipt_background.png';
      const RC_PATH = `img/receipt/${item}_receipt.png`;

      document.getElementById('bg').style.backgroundImage = `url('${BG_PATH}')`;

      const receipt = document.getElementById('receiptImg');
      receipt.src = RC_PATH;

      // ì˜ëª»ëœ item ê°’ì¼ ë•Œ ê¸°ë³¸ ì˜ìˆ˜ì¦ìœ¼ë¡œ í´ë°±
      receipt.onerror = function () {
        this.onerror = null;
        this.src = 'img/receipt/salad_gardenbag_receipt.png';
      };
    })();
  </script>

  <!-- iOS ì•±ìœ¼ë¡œ í”„ë¦°íŠ¸ ìš”ì²­ ë³´ë‚´ëŠ” ë¶€ë¶„ -->
    <!-- iOS ì•±ìœ¼ë¡œ í”„ë¦°íŠ¸ ìš”ì²­ ë³´ë‚´ëŠ” ë¶€ë¶„ (ë””ë²„ê·¸ ë²„ì „) -->
  <script>
    function printReceipt() {
      const params = new URLSearchParams(location.search);
      const item = params.get('item') || 'salad_gardenbag';

      // 1ë‹¨ê³„: ë²„íŠ¼ í´ë¦­ ìì²´ê°€ ë˜ëŠ”ì§€
      alert('ë²„íŠ¼ í´ë¦­ ë¨\nitem = ' + item);

      // iOS WKWebView ì•ˆì—ì„œë§Œ ë™ì‘
      if (window.webkit &&
          window.webkit.messageHandlers &&
          window.webkit.messageHandlers.printReceipt) {

        const payload = {
          item: item,
          url: location.href,
          time: new Date().toISOString()
        };

        try {
          window.webkit.messageHandlers.printReceipt.postMessage(payload);
          alert('iOSë¡œ í”„ë¦°íŠ¸ ìš”ì²­ ë³´ëƒ„ âœ…');
        } catch (e) {
          alert('postMessage ì¤‘ ì—ëŸ¬ ë°œìƒâŒ\n' + e);
        }
      } else {
        alert('iOS WebView ë¸Œë¦¿ì§€ ì—†ìŒ\n(ì‚¬íŒŒë¦¬ì—ì„œ ì—° ê±´ì§€ í™•ì¸)');
      }
    }

    // DOMì´ ë‹¤ ê·¸ë ¤ì§„ ë’¤ì— ë²„íŠ¼ì— ì´ë²¤íŠ¸ ì—°ê²°
    document.addEventListener('DOMContentLoaded', function () {
      const btn = document.getElementById('printBtn');
      if (btn) {
        btn.addEventListener('click', printReceipt);
      } else {
        alert('printBtn ëª»ì°¾ìŒ ğŸ˜¢');
      }
    });
  </script>

 
</body>
</html>

